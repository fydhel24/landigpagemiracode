---
import { Astronav } from "astro-navbar";

const menuitems = [
  { href: '/', label: 'Inicio' },
  { href: '/about', label: 'Sobre nosotros' },
  { href: '/services', label: 'Servicios' },
  { href: '/pricing', label: 'Precios' },
  { href: '/articles', label: 'Blog'},
];

const navButton = { href: "/#contact", label: "Cont√°ctanos" };
---

<style>
  /* Subrayado animado con degradado */
  .nav-underline {
    position: relative;
    display: inline-block;
  }

  .nav-underline::after {
    content: "";
    position: absolute;
    left: 50%;
    bottom: -2px;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #ff7f50, #8a2be2, #00ffff);
    transform: translateX(-50%);
    transition: width 0.35s ease;
  }

  .nav-underline:hover::after {
    width: 100%;
  }
</style>

<div class="h-16">
  <!-- Spacer for fixed navbar -->
  <nav
    class="w-full top-0 left-0 z-50 fixed bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 transition-colors duration-300 shadow-sm"
  >
    <header
      class="flex flex-col lg:flex-row justify-between items-center py-3 px-6 md:px-12 max-w-7xl mx-auto"
    >
      <Astronav>
        <div class="flex w-full lg:w-auto items-center justify-between">
          <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse">
            <img src="/Logo.svg" class="h-7 w-auto" alt="Logo" />
          </a>
          <div class="block lg:hidden">
            <div
              id="menu-icon"
              class="w-6 h-6 text-black dark:text-white cursor-pointer transition-colors duration-300"
            >
              <!-- Open (hamburger) icon -->
              <svg
                id="open-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                class="w-6 h-6"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
              <!-- Close (X) icon -->
              <svg
                id="close-icon"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                class="w-6 h-6 hidden"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"></path>
              </svg>
            </div>
          </div>
        </div>

        <nav
          class="hidden w-full lg:w-auto mt-2 lg:flex lg:mt-0"
          id="menu-items"
        >
          <ul
            class="font-medium flex flex-col p-4 lg:p-0 mt-4 border border-gray-200 rounded-lg bg-white dark:bg-gray-800 lg:bg-transparent lg:dark:bg-transparent lg:flex-row lg:space-x-6 lg:mt-0 lg:border-0"
          >
            {
              menuitems.map((item) => (
                <li>
                  <a
                    href={item.href}
                    class="nav-underline mobile-nav-link block py-2 px-3 text-sm text-gray-700 dark:text-gray-300 hover:text-black dark:hover:text-white transition-colors duration-200"
                    data-close-menu="true"
                  >
                    {item.label}
                  </a>
                </li>
              ))
            }

            <div
              class="lg:hidden flex flex-col items-center justify-center mt-4 gap-3 pb-4"
            >
              <!-- Mobile theme toggle -->
              <button
                id="theme-toggle-mobile"
                class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"
              >
                <!-- Sol -->
                <svg
                  id="sun-icon-mobile"
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-5 h-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364l-1.414 1.414M6.05 17.95l-1.414 1.414M17.95 17.95l-1.414-1.414M6.05 6.05L4.636 7.464M12 8a4 4 0 100 8 4 4 0 000-8z"
                  ></path>
                </svg>
                <!-- Luna -->
                <svg
                  id="moon-icon-mobile"
                  xmlns="http://www.w3.org/2000/svg"
                  class="w-5 h-5 hidden"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"></path>
                </svg>
              </button>

              <a
                class="px-5 py-2 rounded-lg bg-black text-white hover:bg-gray-800 dark:bg-white dark:text-black dark:hover:bg-gray-200 transition-all duration-200 text-sm font-medium"
                href={navButton.href}
                data-close-menu="true"
              >
                {navButton.label}
              </a>
            </div>
          </ul>
        </nav>
      </Astronav>

      <div class="hidden lg:flex items-center gap-3">
        <!-- Desktop theme toggle -->
        <button
          id="theme-toggle"
          class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 transition-colors duration-200"
        >
          <!-- Sol -->
          <svg
            id="sun-icon"
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 3v2m0 14v2m9-9h-2M5 12H3m15.364-6.364l-1.414 1.414M6.05 17.95l-1.414 1.414M17.95 17.95l-1.414-1.414M6.05 6.05L4.636 7.464M12 8a4 4 0 100 8 4 4 0 000-8z"
            ></path>
          </svg>
          <!-- Luna -->
          <svg
            id="moon-icon"
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5 hidden"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 12.79A9 9 0 1111.21 3a7 7 0 109.79 9.79z"></path>
          </svg>
        </button>

        <a
          class="px-5 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-transparent hover:bg-black hover:text-white hover:border-black dark:text-white dark:hover:bg-white dark:hover:text-black dark:hover:border-white transition-all duration-200 text-sm font-medium"
          href={navButton.href}
        >
          {navButton.label}
        </a>
      </div>
    </header>
  </nav>
</div>

<script is:inline>
  function initNavbar() {
    const menuIcon = document.getElementById("menu-icon");
    const openIcon = document.getElementById("open-icon");
    const closeIcon = document.getElementById("close-icon");
    const menuItems = document.getElementById("menu-items");
    const closeMenuItems = document.querySelectorAll(
      '[data-close-menu="true"]',
    );

    // Remove old listeners to prevent duplicates if re-running
    const newMenuIcon = menuIcon?.cloneNode(true);
    if (menuIcon && newMenuIcon) {
      menuIcon.parentNode.replaceChild(newMenuIcon, menuIcon);

      newMenuIcon.addEventListener("click", () => {
        menuItems?.classList.toggle("hidden");
        openIcon?.classList.toggle("hidden");
        closeIcon?.classList.toggle("hidden");
      });
    }

    closeMenuItems.forEach((item) => {
      // Clone to remove listeners
      const newItem = item.cloneNode(true);
      item.parentNode.replaceChild(newItem, item);

      newItem.addEventListener("click", () => {
        menuItems?.classList.add("hidden");
        openIcon?.classList.remove("hidden");
        closeIcon?.classList.add("hidden");
      });
    });

    // Theme toggle
    const themeToggle = document.getElementById("theme-toggle");
    const themeToggleMobile = document.getElementById("theme-toggle-mobile");

    const sunIcon = document.getElementById("sun-icon");
    const moonIcon = document.getElementById("moon-icon");
    const sunIconMobile = document.getElementById("sun-icon-mobile");
    const moonIconMobile = document.getElementById("moon-icon-mobile");

    const updateIcons = (isDark) => {
      if (isDark) {
        sunIcon?.classList.add("hidden");
        moonIcon?.classList.remove("hidden");
        sunIconMobile?.classList.add("hidden");
        moonIconMobile?.classList.remove("hidden");
      } else {
        sunIcon?.classList.remove("hidden");
        moonIcon?.classList.add("hidden");
        sunIconMobile?.classList.remove("hidden");
        moonIconMobile?.classList.add("hidden");
      }
    };

    // Check current theme on init
    const currentTheme = localStorage.getItem("theme") || "light";

    if (currentTheme === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
    updateIcons(document.documentElement.classList.contains("dark"));

    const toggleTheme = () => {
      const isDark = document.documentElement.classList.toggle("dark");
      localStorage.setItem("theme", isDark ? "dark" : "light");
      updateIcons(isDark);
    };

    // Remove old listeners
    const newThemeToggle = themeToggle?.cloneNode(true);
    if (themeToggle && newThemeToggle) {
      themeToggle.parentNode.replaceChild(newThemeToggle, themeToggle);
      newThemeToggle.addEventListener("click", toggleTheme);
    }

    const newThemeToggleMobile = themeToggleMobile?.cloneNode(true);
    if (themeToggleMobile && newThemeToggleMobile) {
      themeToggleMobile.parentNode.replaceChild(
        newThemeToggleMobile,
        themeToggleMobile,
      );
      newThemeToggleMobile.addEventListener("click", toggleTheme);
    }
  }

  // Run on initial load
  initNavbar();

  // Run on view transitions navigation
  document.addEventListener("astro:page-load", initNavbar);
</script>
